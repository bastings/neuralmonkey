[main]
name="birnn gcn"
output="exp-news/birnn_gcn_2l_en2de"
runners=[<runner>]
tf_manager=<tf_manager>
trainer=<trainer>
train_dataset=<train_data>
val_dataset=<val_data>
evaluation=[("target", evaluators.ter.TER), ("target", <bleu1>), ("target", <bleu>)]
batch_size=80
runners_batch_size=256
epochs=45
validation_period=2836
logging_period=100
overwrite_output_dir=False
val_preview_num_examples=3

[bpe_preprocess]
class=processors.bpe.BPEPreprocessor
merge_file="/home/bastings/data/news_v11/de.bpe.8000"

[bpe_postprocess]
class=processors.bpe.BPEPostprocessor

[train_data]
class=dataset.load_dataset_from_files
s_source="/home/bastings/data/news_v11/news-commentary-v11.de-en.clean.tok.en"
s_tags="/home/bastings/data/news_v11/news-commentary-v11.de-en.clean.upos.en"
s_deprels="/home/bastings/data/news_v11/news-commentary-v11.de-en.clean.deprels.en"
s_heads="/home/bastings/data/news_v11/news-commentary-v11.de-en.clean.heads.en"
s_target="/home/bastings/data/news_v11/news-commentary-v11.de-en.clean.tok.de"
preprocessors=[("target", "target_bpe", <bpe_preprocess>)]

[val_data]
class=dataset.load_dataset_from_files
s_source="/home/bastings/data/wmt16/dev/newstest2015-ende-src.tok.en"
s_tags="/home/bastings/data/wmt16/dev/newstest2015-ende-src.upos.en"
s_deprels="/home/bastings/data/wmt16/dev/newstest2015-ende-src.deprels.en"
s_heads="/home/bastings/data/wmt16/dev/newstest2015-ende-src.heads.en"
s_target="/home/bastings/data/wmt16/dev/newstest2015-ende-ref.tok.de"
preprocessors=[("target", "target_bpe", <bpe_preprocess>)]

[source_word_vocabulary]
;class=vocabulary.from_dataset
;datasets=[<train_data>]
;save_file="exp-news/birnn_gcn_2l_en2de/source_word_vocabulary.pkl"
;series_ids=["source"]
;overwrite=False
;unk_sample_prob=0.5
;max_size=50000
;min_freq=3
class=vocabulary.from_file
path="exp-news/birnn_gcn_2l_en2de/source_word_vocabulary.pkl"

[tag_vocabulary]
;class=vocabulary.from_dataset
;datasets=[<train_data>]
;save_file="exp-news/birnn_gcn_2l_en2de/tag_vocabulary.pkl"
;series_ids=["tags"]
;overwrite=False
;unk_sample_prob=0.0
;max_size=100
class=vocabulary.from_file
path="exp-news/birnn_gcn_2l_en2de/tag_vocabulary.pkl"

[deprel_vocabulary]
;class=vocabulary.from_dataset
;datasets=[<train_data>]
;save_file="exp-news/birnn_gcn_2l_en2de/deprel_vocabulary.pkl"
;series_ids=["deprels"]
;overwrite=False
;unk_sample_prob=0.0
;max_size=100
class=vocabulary.from_file
path="exp-news/birnn_gcn_2l_en2de/deprel_vocabulary.pkl"

[target_word_vocabulary]
class=vocabulary.from_bpe
path="/home/bastings/data/news_v11/de.bpe.8000"

[encoder]
class=encoders.sentence_encoder.SentenceEncoder
name="sentence_encoder"
rnn_size=512
max_input_len=50
embedding_size=256
dropout_keep_prob=0.8
attention_type=decoding_function.Attention
data_id="source"
vocabulary=<source_word_vocabulary>
add_start_symbol=True

[gcn_encoder]
class=encoders.gcn_encoder.GCNEncoder
name="gcn_encoder"
layer_size=1024
max_input_len=50
num_layers=2
dropout_keep_prob=0.8
edge_dropout_keep_prob=0.8
attention_type=decoding_function.Attention
data_ids=["source", "tags", "deprels", "heads"]
residual=True
vocabularies=[<source_word_vocabulary>, <tag_vocabulary>, <deprel_vocabulary>]
parent_encoder=<encoder>

[decoder]
class=decoders.decoder.Decoder
name="decoder"
encoders=[<gcn_encoder>]
rnn_size=512
embedding_size=256
dropout_keep_prob=0.8
use_attention=True
data_id="target_bpe"
vocabulary=<target_word_vocabulary>
max_output_len=50

[trainer]
class=trainers.cross_entropy_trainer.CrossEntropyTrainer
decoders=[<decoder>]
l2_weight=1.0e-8
optimizer=<adam>

[adam]
class=config.utils.adam_optimizer
learning_rate=1.0e-3

[runner]
class=runners.runner.GreedyRunner
decoder=<decoder>
output_series="target"
postprocess=<bpe_postprocess>

[bleu]
class=evaluators.bleu.BLEUEvaluator
name="BLEU-4"

[bleu1]
class=evaluators.bleu.BLEUEvaluator
n=1
name="BLEU-1"

[tf_manager]
class=tf_manager.TensorFlowManager
num_threads=4
num_sessions=1
save_n_best=1
minimize_metric=False
